name: Edion Stock Monitor

on:
  # 5分ごとに定期実行
  schedule:
    - cron: '*/5 * * * *'
  
  # 手動実行も可能
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run (通知を送信しない)'
        required: false
        default: 'false'
        type: boolean

jobs:
  check-stock:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install chromium firefox
          playwright install-deps
      
      - name: Run stock monitor
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          if [ "${{ github.event.inputs.dry_run }}" == "true" ]; then
            python monitor.py --dry-run
          else
            python monitor.py
          fi
